import { getTenantContext } from "@/lib/get-tenant-context";
import { BoldProvider } from "@/components/providers/bold-provider";
import "./globals.css";

export const dynamic = "force-dynamic";

export const metadata = {
  title: "Bold Demo Site",
  description: "Generated by bold.video",
};

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const context = await getTenantContext();
  const theme = context?.settings?.theme_config;

  return (
    <html lang="en">
      <head>
        {theme && (
          <style
            dangerouslySetInnerHTML={{
              __html: `
              :root {
                --radius: ${theme.radius || "0.5rem"};
                --background: ${theme.light?.background || ""};
                --foreground: ${theme.light?.foreground || ""};
                --muted: ${theme.light?.muted || ""};
                --muted-foreground: ${theme.light?.["muted-foreground"] || ""};
                --border: ${theme.light?.border || ""};
                --ring: ${theme.light?.ring || ""};
                --surface: ${theme.light?.surface || ""};
                --accent: ${theme.light?.accent || ""};
                --accent-foreground: ${theme.light?.["accent-foreground"] || ""};
              }
              .dark {
                --background: ${theme.dark?.background || ""};
                --foreground: ${theme.dark?.foreground || ""};
                --muted: ${theme.dark?.muted || ""};
                --muted-foreground: ${theme.dark?.["muted-foreground"] || ""};
                --border: ${theme.dark?.border || ""};
                --ring: ${theme.dark?.ring || ""};
                --surface: ${theme.dark?.surface || ""};
                --accent: ${theme.dark?.accent || ""};
                --accent-foreground: ${theme.dark?.["accent-foreground"] || ""};
              }
            `,
            }}
          />
        )}
      </head>
      <body className="bg-background text-foreground">
        {context ? (
          <BoldProvider
            token={context.tenantToken}
            baseURL={process.env.BACKEND_URL || "https://app.boldvideo.io/api/v1"}
          >
            {children}
          </BoldProvider>
        ) : (
          children
        )}
      </body>
    </html>
  );
}
